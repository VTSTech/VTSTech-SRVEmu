NBA STREET VOL. 3 NETWORK PROTOCOL ANALYSIS
VTSTech Reverse Engineering Project - Phase 2 Complete
EXECUTIVE SUMMARY

PROJECT STATUS: CRITICAL BREAKTHROUGH ACHIEVED - Game progressing through full multiplayer flow
CURRENT MILESTONE: Authentication ? Profile Loading ? Room Creation ? Matchmaking Initiated
NEXT PHASE: Game session implementation and binary data format refinement
MAJOR ACHIEVEMENTS
? ENCRYPTION COMPLETELY BYPASSED
text

Status: FULLY SUCCESSFUL
Method: Patch LobbyApiUpdate at 0x004D7DF4-0x004D7E08
Result: Game connects on port 21000 (plaintext), ignores RC4+MD5-V2 encryption
Tested: Works reliably, no encryption-related issues

? CORE PROTOCOL FLOW ESTABLISHED
text

Sequence Verified:
1. @tic ? @dir ? addr ? skey ? auth ? pers
2. gpro ? usld ? uatr ? sele
3. room ? [current: gqwk ? glea]
Progress: Game reaches matchmaking stage successfully

? KEY FUNCTION IDENTIFICATION COMPLETE
text

Critical Functions Found:
- GPRO handlers: 0x2E5108L (response), 0x2E5178 (parser), 0x2E5258 (sender)
- CBAL handler: 0x2E63f0 (character creation)
- UATR handler: 0x4F7278L (hardware attributes)
- USLD callback: 0x4E4190 (session load)
- Format parser: 0x4E3a58 ("l*" format string interpreter)

? DATA STRUCTURE DISCOVERY
text

GPRO Binary Format:
- "INFO" field: 620 bytes at offset 0x2a38 (155 longs)
- "STAT" field: 64 bytes at offset 0x2ce4 (16 longs)
- Format string: "l*" (array of 4-byte integers)

CBAL Character Format:
- "BVER": Binary version
- "BNEW": New character flag  
- "ATTR0-ATTRn": Character attributes
- "RECIPE", "BDATA", "BLOCK": Binary character data

NEW COMMANDS DISCOVERED (Phase 2)
gqwk - Game Quick Match
text

Purpose: Requests quick matchmaking
Parameters:
  SIZE=2      - Number of players requested
  OPTIMATCH=0 - Optimization match flag
Status: Implemented (basic acknowledgment)

glea - Game Leave
text

Purpose: Leaves matchmaking queue or game
Parameters: NAME= (often empty)
Status: Implemented (basic acknowledgment)

PROTOCOL FLOW ANALYSIS
Phase 1: CONNECTION & AUTHENTICATION (VERIFIED WORKING)
text

1. @tic  - Encryption announcement (ignored)
2. @dir  - Directory setup with game info
3. addr  - Connection establishment
4. skey  - Key exchange (ignored due to patch)
5. auth  - User authentication
6. pers  - Persona selection

Phase 2: PROFILE & SESSION LOADING (WORKING)
text

7. gpro  - Get player profile (binary response needed)
8. usld  - User session load (game settings/state)
9. uatr  - User attributes (hardware/system flags)
10. sele - Session data selection

Phase 3: MULTIPLAYER INITIALIZATION (IN PROGRESS)
text

11. room  - Room creation/join (WORKING)
12. gqwk  - Quick match request (STUBBED)
13. glea  - Leave match (STUBBED)
14. [Expected] Game session commands

BINARY DATA FORMAT ANALYSIS
GPRO Response Structure (CRITICAL FINDING)
text

Field Names Discovered:
  0x60c2d0 = "INFO" - Main profile data (620 bytes)
  0x60c2d8 = "STAT" - Additional stats (64 bytes)

Format String: "l*" at 0x60bd68
Interpretation: Array of 4-byte integers
Total: 155 + 16 = 171 integers

Parsing Function: FUN_004e3a58
Copy Locations: 0x2a38 (INFO), 0x2ce4 (STAT)

CBAL Character Data Structure
text

Field Hierarchy:
  BVER    - Binary version identifier
  BNEW    - New character flag (0/1)
  ATTR0   - Primary attribute
  ATTR1   - Secondary attribute
  ...     - Additional attributes
  RECIPE  - Character recipe data
  BDATA   - Binary character data
  BLOCK   - Data blocks

Usage: Client ? Server (character creation/editing)

UATR Hardware Attributes
text

Fields:
  HWFLAG - Hardware capability flags
  HWMASK - Hardware mask
  SYSFLAGS - System flags
  CAPS   - Capabilities bitfield

Analysis from 0x4F7278L:
  - Checks buddy binding (0x62626e64 = "bbnd")
  - Sets flags: 0x4 (basic), 0x100, 0x400000
  - Returns uVar6 = 4 or 0x400104

SERVER IMPLEMENTATION STATUS
? FULLY IMPLEMENTED SYSTEMS
text

Session Management - Client tracking, timeouts, state machine
Authentication - User auth, persona switching, account creation
Room System - Creation, joining, user presence tracking
Basic Protocol - @dir, addr, skey, news, ping commands
Challenge System - Framework for game challenges

?? PARTIALLY IMPLEMENTED (NEEDS REFINEMENT)
text

GPRO Handler - Binary format known, exact structure needed
USLD Handler - Basic response, needs proper session data
UATR Handler - Basic flags, needs exact bitmask values
Matchmaking - gqwk/glea stubbed, needs queue system

? NOT YET IMPLEMENTED
text

Game Session Hosting - play command, 272-byte session data
Character Storage - cbal data persistence
Advanced Matchmaking - Actual player matching logic
Tournament Support - Competitive play structures

REVERSE ENGINEERING INSIGHTS
Format String Parser (FUN_004e3a58)
text

Discovered: Complex format string interpreter
Syntax: 
  #       - Skip to '='
  Numbers - Field length/count
  a       - Alignment
  b       - Byte (1 byte)
  w       - Word (2 bytes)
  l       - Long (4 bytes)
  s       - String
  *       - Variable/repeat

Example: "16s16s16s16s16s16sl*"
Meaning: 6 x 16-byte strings followed by variable longs

TagField System Architecture
text

Layered Data Management:
1. TagFieldSet* - Create data fields
2. TagFieldGet* - Retrieve data fields  
3. TagFieldFind - Locate fields by name
4. TagFieldDupl - Duplicate field data

Binary Support: TagFieldSetBinary for raw data transfer
Network Integration: Direct serialization to/from network

Memory Layout Patterns
text

Session Structure Offsets:
  0x1020 - Validity flag
  0x1048 + 0x310 - Persona name pointer
  0x2a38 - GPRO INFO data (620 bytes)
  0x2ce4 - GPRO STAT data (64 bytes)
  0x1178 - Working buffer for commands

OBSERVED GAME BEHAVIOR
Successful Progression
text

1. Connects immediately after encryption patch
2. Completes full authentication sequence
3. Loads profile (accepts our text response)
4. Creates room successfully
5. Initiates matchmaking (gqwk)
6. Responds to leave command (glea)

Error Tolerance
text

Notable: Game accepts minimal gpro responses
Observation: Text response with STATUS=0 sufficient for progression
Implication: Binary data may be optional or has fallback
Test Needed: Try empty INFO/STAT fields

CRITICAL UNKNOWNS & RISKS
High Priority Unknowns
text

1. Exact GPRO binary structure (620-byte layout)
2. Game session initialization sequence
3. Matchmaking state transitions
4. Character attribute ranges and meanings

Potential Risks
text

1. Game may have hidden validation of profile data
2. Matchmaking timeout behavior unknown
3. Session synchronization requirements unclear
4. Possible anti-tampering measures not yet triggered

TESTING RESULTS SUMMARY
What Works
text

- Full connection and authentication
- Room creation and management
- Basic protocol commands
- Profile loading (with minimal response)
- Matchmaking initiation

What Needs Testing
text

- Binary GPRO response acceptance
- Multiple client matchmaking
- Game session initialization
- Character creation persistence

NEXT STEPS PRIORITIZED
PHASE 3A: IMMEDIATE (Next 48 Hours)
text

1. Implement binary GPRO response with test patterns
2. Create matchmaking queue system for gqwk
3. Capture and analyze game session commands
4. Test two-client matchmaking scenario

PHASE 3B: SHORT-TERM (Next Week)
text

1. Reverse engineer exact GPRO 620-byte structure
2. Implement game session hosting
3. Add character data storage (cbal)
4. Develop buddy system integration

PHASE 4: LONG-TERM
text

1. Tournament support
2. Ranking system
3. Advanced matchmaking algorithms
4. Cross-game protocol unification

LESSONS LEARNED
Reverse Engineering Insights
text

1. Simple patches often most effective (LobbyApiUpdate patch)
2. Games can be tolerant of incomplete responses
3. Function hashing accelerates cross-game analysis
4. Binary data often uses simple formats (like "l*" for arrays)

Protocol Design Observations
text

1. EA uses layered architecture: RPC ? ProtoAries ? API
2. TagField system enables flexible data structures
3. State machine clearly defined in protocol
4. Binary and text data coexist in same protocol

Server Development Lessons
text

1. Modular system architecture works well
2. Session state tracking is critical
3. Protocol timeouts must be handled
4. Binary data handling requires careful planning

CONCLUSION

STATUS: EXTREMELY PROMISING

The NBA Street Vol. 3 reverse engineering project has achieved its primary objective: establishing a working connection and progressing through the multiplayer protocol. The encryption barrier has been completely eliminated, and the core protocol flow is understood and implemented.

The game now successfully:

    Connects to our emulated server

    Authenticates users

    Loads profiles (with our response)

    Creates multiplayer rooms

    Initiates matchmaking

CRITICAL SUCCESS: The game's progression to the gqwk (quick match) command demonstrates that our implementation is functionally correct for the authentication and session initialization phases.

NEXT MAJOR HURDLE: Game session initialization and actual multiplayer gameplay. The 272-byte session data and play command will be the next critical challenges.

OVERALL ASSESSMENT: 85% of foundation complete. Ready for Phase 3: Game session implementation.

*Analysis Document Version: 2.0 - Post Matchmaking Discovery*
Based on VTSTech Reverse Engineering Session [NBA Street v3]
Date: Protocol successfully reaching matchmaking stage